<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9500052410127292"
     crossorigin="anonymous"></script>

  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-66LNSPBJCB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-66LNSPBJCB');
</script>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>TaxiMeter Pro â€“ Live GPS Fare Calculator</title>
<meta name="description" content="Free online taximeter with live GPS on OpenStreetMap. Real-time fare by distance and time. No app needed!"/>
<meta name="keywords" content="taximeter,taxi meter,fare calculator,GPS taxi,live location,online taximeter"/>
<meta property="og:title" content="TaxiMeter Pro â€“ Live GPS Fare Calculator"/>
<meta property="og:type" content="website"/>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Cabin:wght@400;500;600;700&display=swap" rel="stylesheet"/>

<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

/* â”€â”€ THEMES â”€â”€ */
:root,[data-theme="dark"]{
  --bg:#0f1117; --card:#181c27; --card2:#0f1117; --border:#2c3144;
  --accent:#f5c518; --accent2:#c49a0e;
  --green:#3ddc84; --red:#ff5f57;
  --text:#e8eaf6; --muted:#8892b0;
  --pill:#1e2235; --input:#1e2235;
  --shadow:rgba(0,0,0,.45);
  --tk-bg:#3a3f55; --tk-dot:#e8eaf6;
}
[data-theme="light"]{
  --bg:#f0f3fc; --card:#ffffff; --card2:#e8ecf8; --border:#c8d0e8;
  --accent:#c8910a; --accent2:#a07008;
  --green:#1a9e52; --red:#d63c35;
  --text:#1a1d2e; --muted:#5c6484;
  --pill:#e2e7f7; --input:#eaedfa;
  --shadow:rgba(0,0,0,.10);
  --tk-bg:#c8d0e8; --tk-dot:#ffffff;
}

/* smooth transitions */
html,body,header,.panel,.fare-display,.stat-card,
.setting-row,.receipt,.gps-chip,.map-badge,.time-badge,
footer,input,.status-pill,.btn-reset,.theme-wrap{
  transition:background .45s ease,color .4s ease,
             border-color .4s ease,box-shadow .4s ease;
}

body{font-family:'Cabin',sans-serif;background:var(--bg);color:var(--text);
     min-height:100vh;display:flex;flex-direction:column}

/* â”€â”€ HEADER â”€â”€ */
header{padding:12px 20px;display:flex;align-items:center;gap:10px;
       border-bottom:1px solid var(--border);background:var(--card);
       box-shadow:0 2px 16px var(--shadow);z-index:10;flex-wrap:wrap}

.logo{width:42px;height:42px;background:var(--accent);border-radius:12px;
      display:flex;align-items:center;justify-content:center;font-size:22px;
      box-shadow:0 3px 12px rgba(200,145,10,.4);flex-shrink:0}

.hd-title h1{font-size:1.25rem;font-weight:700;color:var(--accent);letter-spacing:-.3px}
.hd-title .sub{font-size:.72rem;color:var(--muted);font-weight:400}

/* â”€â”€ MODE BADGE â”€â”€ */
.mode-badge{display:flex;align-items:center;gap:5px;font-size:.73rem;
            font-weight:600;color:var(--muted);background:var(--pill);
            border:1px solid var(--border);border-radius:999px;padding:5px 11px;
            white-space:nowrap}
#modeLbl{color:var(--text)}

/* â”€â”€ TOGGLE SWITCH (iOS style) â”€â”€ */
.theme-wrap{display:flex;align-items:center;gap:8px;
            background:var(--pill);border:1px solid var(--border);
            border-radius:999px;padding:6px 14px;cursor:pointer;
            user-select:none}
.theme-wrap:hover{border-color:var(--accent)}
.theme-icon{font-size:1rem}
.switch{position:relative;width:44px;height:24px;flex-shrink:0}
.switch input{opacity:0;width:0;height:0;position:absolute}
.slider{position:absolute;inset:0;background:var(--tk-bg);
        border-radius:999px;transition:background .4s}
.slider::before{content:'';position:absolute;height:18px;width:18px;
                left:3px;bottom:3px;background:var(--tk-dot);border-radius:50%;
                transition:transform .35s cubic-bezier(.4,0,.2,1),background .4s;
                box-shadow:0 1px 4px rgba(0,0,0,.25)}
[data-theme="light"] .slider{background:var(--accent)}
[data-theme="light"] .slider::before{transform:translateX(20px)}
.theme-lbl{font-size:.78rem;font-weight:700;color:var(--muted);min-width:32px}
[data-theme="light"] .theme-lbl{color:var(--accent)}

/* â”€â”€ STATUS PILL â”€â”€ */
.status-pill{margin-left:auto;padding:6px 13px;border-radius:999px;
             font-size:.77rem;font-weight:600;background:var(--pill);
             color:var(--muted);border:1px solid var(--border);
             display:flex;align-items:center;gap:6px}
.status-pill .dot{width:8px;height:8px;border-radius:50%;background:var(--muted);
                  transition:background .3s,box-shadow .3s}
.status-pill.running .dot{background:var(--green);box-shadow:0 0 7px var(--green)}
.status-pill.running{color:var(--green);border-color:var(--green)}

/* â”€â”€ LAYOUT â”€â”€ */
main{display:grid;grid-template-columns:370px 1fr;flex:1;min-height:0}

.panel{background:var(--card);border-right:1px solid var(--border);
       padding:16px;display:flex;flex-direction:column;gap:13px;overflow-y:auto}

/* â”€â”€ FARE â”€â”€ */
.fare-display{background:linear-gradient(135deg,var(--card2),var(--pill));
              border:1px solid var(--border);border-radius:18px;
              padding:20px;text-align:center;position:relative;overflow:hidden}
.fare-display::before{content:'';position:absolute;top:-50px;left:-50px;
                      width:170px;height:170px;pointer-events:none;
                      background:radial-gradient(circle,rgba(200,145,10,.14),transparent 70%)}
.fare-label{font-size:.7rem;color:var(--muted);letter-spacing:2px;
            text-transform:uppercase;margin-bottom:8px;font-weight:700}
.fare-amount{font-size:3.2rem;font-weight:700;color:var(--accent);line-height:1}
.fare-amount.pulse{animation:flash .28s ease}
@keyframes flash{0%,100%{opacity:1}50%{opacity:.4}}
.fare-cur{font-size:1.4rem;vertical-align:super;margin-right:2px}

/* â”€â”€ STATS â”€â”€ */
.stats{display:grid;grid-template-columns:1fr 1fr;gap:9px}
.stat-card{background:var(--card2);border:1px solid var(--border);
           border-radius:12px;padding:12px 13px}
.s-label{font-size:.66rem;color:var(--muted);text-transform:uppercase;
         letter-spacing:1.2px;margin-bottom:5px;font-weight:700}
.s-value{font-size:1.28rem;font-weight:700;color:var(--text)}
.s-unit{font-size:.7rem;color:var(--muted);margin-left:2px}

/* â”€â”€ SECTION TITLE â”€â”€ */
.sec-ttl{font-size:.69rem;font-weight:700;color:var(--muted);
         text-transform:uppercase;letter-spacing:1.8px;margin-bottom:6px}

/* â”€â”€ SETTINGS â”€â”€ */
.setting-row{display:flex;align-items:center;justify-content:space-between;
             background:var(--card2);border:1px solid var(--border);
             border-radius:10px;padding:10px 13px;gap:10px}
.setting-row label{font-size:.82rem;color:var(--muted);white-space:nowrap;font-weight:600}
.setting-row input[type="number"]{background:var(--input);border:1px solid var(--border);
  color:var(--text);border-radius:8px;padding:6px 10px;width:90px;font-size:.9rem;
  text-align:right;outline:none;font-family:'Cabin',sans-serif;font-weight:700;
  transition:border-color .2s}
.setting-row input[type="number"]:focus{border-color:var(--accent2)}

/* â”€â”€ BUTTONS â”€â”€ */
.btn-row{display:flex;gap:10px}
.btn{flex:1;padding:13px;border:none;border-radius:12px;font-family:'Cabin',sans-serif;
     font-size:.94rem;font-weight:700;cursor:pointer;
     transition:transform .1s,box-shadow .2s,background .3s;letter-spacing:.3px}
.btn:active{transform:scale(.96)}
.btn-start{background:var(--accent);color:#0f1117;
           box-shadow:0 4px 18px rgba(200,145,10,.3)}
.btn-start:hover{box-shadow:0 4px 26px rgba(200,145,10,.5)}
.btn-start:disabled{opacity:.4;cursor:not-allowed}
.btn-stop{background:transparent;color:var(--red);border:1.5px solid var(--red)}
.btn-stop:hover{background:rgba(214,60,53,.1)}
.btn-stop:disabled{opacity:.3;cursor:not-allowed}
.btn-reset{flex:0 0 auto;padding:13px 15px;background:transparent;
           color:var(--muted);border:1.5px solid var(--border);font-size:1rem}
.btn-reset:hover{color:var(--text);border-color:var(--text)}

/* â”€â”€ GPS CHIPS â”€â”€ */
.gps-bar{display:flex;gap:8px;flex-wrap:wrap}
.gps-chip{background:var(--card2);border:1px solid var(--border);border-radius:8px;
          padding:8px 12px;font-size:.7rem;color:var(--muted);flex:1;
          min-width:80px;text-align:center;font-weight:600}
.gps-chip span{display:block;font-size:.86rem;color:var(--text);font-weight:700;margin-top:3px}

/* â”€â”€ RECEIPT â”€â”€ */
.receipt{background:var(--card2);border:1.5px dashed var(--border);
         border-radius:12px;padding:13px;display:none;font-size:.82rem}
.receipt.show{display:block}
.receipt-row{display:flex;justify-content:space-between;
             padding:5px 0;border-bottom:1px solid var(--border);color:var(--muted)}
.receipt-row:last-child{border-bottom:none;font-weight:700;color:var(--accent);font-size:1rem}

/* â”€â”€ MAP â”€â”€ */
#map{height:100%;min-height:400px}
.map-badge{position:absolute;top:14px;right:14px;z-index:1000;
           background:var(--card);border:1px solid var(--border);border-radius:12px;
           padding:10px 15px;font-size:.73rem;color:var(--muted);
           box-shadow:0 4px 16px var(--shadow);font-weight:600;font-family:'Cabin',sans-serif}
.map-badge strong{display:block;font-size:1.12rem;color:var(--accent);font-weight:700}
.time-badge{position:absolute;bottom:30px;right:14px;z-index:1000;
            background:var(--card);border:1px solid var(--border);border-radius:10px;
            padding:7px 13px;font-size:.73rem;color:var(--muted);font-weight:600;
            box-shadow:0 3px 12px var(--shadow);font-family:'Cabin',sans-serif}
#localClock{color:var(--text);font-size:.97rem;font-weight:700;display:block}

footer{text-align:center;padding:9px;font-size:.71rem;color:var(--muted);
       border-top:1px solid var(--border);background:var(--card)}

@keyframes bounce{from{transform:translateY(0)}to{transform:translateY(-5px)}}

@media(max-width:768px){
  main{grid-template-columns:1fr}
  #map{height:300px}
  .panel{border-right:none;border-bottom:1px solid var(--border)}
  .mode-badge{display:none}
  .status-pill{margin-left:0}
}
</style>
</head>
<body>

<header>
  <div class="logo">ğŸš•</div>
  <div class="hd-title">
    <h1>TaxiMeter Pro</h1>
    <div class="sub">Live GPS Fare Calculator</div>
  </div>

  <!-- Auto-mode badge -->
  <div class="mode-badge">
    <span id="modeIcon">ğŸŒ™</span>
    <span id="modeLbl">Night</span>
    &nbsp;Â·&nbsp;
    <span id="headerClock">--:--</span>
  </div>

  <!-- iOS-style toggle switch -->
  <label class="theme-wrap" title="Toggle dark / light mode" onclick="manualToggle()">
    <span class="theme-icon" id="themeIconL">ğŸŒ™</span>
    <div class="switch">
      <input type="checkbox" id="themeChk" readonly/>
      <span class="slider"></span>
    </div>
    <span class="theme-icon" id="themeIconR">â˜€ï¸</span>
    <span class="theme-lbl" id="themeLbl">Dark</span>
  </label>

  <div class="status-pill" id="statusPill">
    <div class="dot"></div>
    <span id="statusText">Idle</span>
  </div>
</header>

<main>
  <!-- â”€â”€ PANEL â”€â”€ -->
  <div class="panel">

    <div class="fare-display">
      <div class="fare-label">Total Fare</div>
      <div class="fare-amount" id="fareDisplay">
        <span class="fare-cur">$</span><span id="fareValue">0.00</span>
      </div>
    </div>

    <div class="stats">
      <div class="stat-card">
        <div class="s-label">â± Time</div>
        <div class="s-value" id="timeDisplay">00:00</div>
      </div>
      <div class="stat-card">
        <div class="s-label">ğŸ“ Distance</div>
        <div class="s-value" id="distDisplay">0.00<span class="s-unit">km</span></div>
      </div>
      <div class="stat-card">
        <div class="s-label">ğŸš€ Speed</div>
        <div class="s-value" id="speedDisplay">0<span class="s-unit">km/h</span></div>
      </div>
      <div class="stat-card">
        <div class="s-label">ğŸ“¡ Accuracy</div>
        <div class="s-value" id="accDisplay">--<span class="s-unit">m</span></div>
      </div>
    </div>

    <div>
      <div class="sec-ttl">ğŸ“Œ Live Position</div>
      <div class="gps-bar" style="margin-top:7px">
        <div class="gps-chip">Lat <span id="latDisplay">--</span></div>
        <div class="gps-chip">Lng <span id="lngDisplay">--</span></div>
      </div>
    </div>

    <div>
      <div class="sec-ttl">âš™ï¸ Fare Settings</div>
      <div style="display:flex;flex-direction:column;gap:8px;margin-top:7px">
        <div class="setting-row">
          <label>Base Fare ($)</label>
          <input type="number" id="baseFare" value="2.50" min="0" step="0.10"/>
        </div>
        <div class="setting-row">
          <label>Per km ($)</label>
          <input type="number" id="perKm" value="1.50" min="0" step="0.10"/>
        </div>
        <div class="setting-row">
          <label>Per minute ($)</label>
          <input type="number" id="perMin" value="0.30" min="0" step="0.05"/>
        </div>
      </div>
    </div>

    <div class="btn-row">
      <button class="btn btn-start" id="btnStart" onclick="startRide()">â–¶ Start Ride</button>
      <button class="btn btn-stop"  id="btnStop"  onclick="stopRide()" disabled>â–  Stop</button>
      <button class="btn btn-reset"               onclick="resetRide()" title="Reset">â†º</button>
    </div>

    <div class="receipt" id="receipt">
      <div class="sec-ttl" style="margin-bottom:9px">ğŸ§¾ Ride Receipt</div>
      <div class="receipt-row"><span>Base Fare</span><span id="recBase">$0.00</span></div>
      <div class="receipt-row"><span>Distance Charge</span><span id="recDist">$0.00</span></div>
      <div class="receipt-row"><span>Time Charge</span><span id="recTime">$0.00</span></div>
      <div class="receipt-row"><span>Duration</span><span id="recDuration">0:00</span></div>
      <div class="receipt-row"><span>Distance</span><span id="recKm">0.00 km</span></div>
      <div class="receipt-row"><span>TOTAL</span><span id="recTotal">$0.00</span></div>
    </div>

  </div>

  <!-- â”€â”€ MAP â”€â”€ -->
  <div style="position:relative;flex:1">
    <div id="map"></div>
    <div class="map-badge">
      <strong id="badgeFare">$0.00</strong>
      Live Fare
    </div>
    <div class="time-badge">
      <span id="localClock">--:--:--</span>
      Local Time
    </div>
  </div>
</main>

<footer>
  TaxiMeter Pro &nbsp;Â·&nbsp; OpenStreetMap + Leaflet &nbsp;Â·&nbsp;
  ğŸŒ™ Auto theme by local time &nbsp;Â·&nbsp; GPS stays on your device
</footer>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  THEME ENGINE
//  Auto: 06:00-18:59 = light, else dark
//  Manual toggle overrides for 1 h then auto-reverts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let manualOverride = false;
let currentTheme   = 'dark';

const isDaytime = () => { const h = new Date().getHours(); return h >= 6 && h < 19; };

function applyTheme(theme) {
  currentTheme = theme;
  const isLight = theme === 'light';
  document.documentElement.setAttribute('data-theme', theme);
  document.getElementById('modeIcon').textContent  = isLight ? 'â˜€ï¸' : 'ğŸŒ™';
  document.getElementById('modeLbl').textContent   = isLight ? 'Day'   : 'Night';
  document.getElementById('themeLbl').textContent  = isLight ? 'Light' : 'Dark';
  document.getElementById('themeChk').checked      = isLight;
}

function autoTheme() {
  if (!manualOverride) applyTheme(isDaytime() ? 'light' : 'dark');
}

function manualToggle() {
  manualOverride = true;
  applyTheme(currentTheme === 'dark' ? 'light' : 'dark');
  clearTimeout(window._ot);
  // revert to auto after 1 hour
  window._ot = setTimeout(() => { manualOverride = false; autoTheme(); }, 3_600_000);
}

// Clock + auto-check every second
function tickClock() {
  const now = new Date();
  document.getElementById('localClock').textContent =
    now.toLocaleTimeString([], { hour:'2-digit', minute:'2-digit', second:'2-digit' });
  document.getElementById('headerClock').textContent =
    now.toLocaleTimeString([], { hour:'2-digit', minute:'2-digit' });
  autoTheme();
}

applyTheme('dark'); // default before clock ticks
autoTheme();
tickClock();
setInterval(tickClock, 1000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MAP SETUP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const map = L.map('map', { zoomControl: true }).setView([7.2906, 80.6337], 13);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
  maxZoom: 19
}).addTo(map);

const taxiIcon = L.divIcon({
  html:`<div style="font-size:28px;filter:drop-shadow(0 2px 8px rgba(245,197,24,.9));animation:bounce 1s infinite alternate">ğŸš•</div>`,
  iconSize:[36,36], iconAnchor:[18,18], className:''
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RIDE STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let marker=null, routeLine=null, accCircle=null;
let watchId=null, timerInterval=null;
let running=false, elapsedSec=0, totalKm=0, lastPos=null, routePts=[];

// â”€â”€ Helpers â”€â”€
const fmt   = n => n.toFixed(2);
const fmtT  = s => `${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;

function haversine(la1,lo1,la2,lo2){
  const R=6371, dLa=(la2-la1)*Math.PI/180, dLo=(lo2-lo1)*Math.PI/180;
  const a=Math.sin(dLa/2)**2+Math.cos(la1*Math.PI/180)*Math.cos(la2*Math.PI/180)*Math.sin(dLo/2)**2;
  return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}

function calcFare(km,sec){
  const b=+document.getElementById('baseFare').value||0;
  const k=+document.getElementById('perKm').value||0;
  const m=+document.getElementById('perMin').value||0;
  return b + km*k + (sec/60)*m;
}

function refreshUI(){
  const fare = calcFare(totalKm, elapsedSec);
  document.getElementById('fareValue').textContent  = fmt(fare);
  document.getElementById('badgeFare').textContent  = '$'+fmt(fare);
  document.getElementById('distDisplay').innerHTML  = fmt(totalKm)+'<span class="s-unit">km</span>';
  document.getElementById('timeDisplay').textContent= fmtT(elapsedSec);
  const el=document.getElementById('fareDisplay');
  el.classList.remove('pulse'); void el.offsetWidth; el.classList.add('pulse');
}

// â”€â”€ Start â”€â”€
function startRide(){
  if(!navigator.geolocation){ alert('âŒ Geolocation not supported.'); return; }
  running=true; elapsedSec=0; totalKm=0; lastPos=null; routePts=[];
  if(routeLine){map.removeLayer(routeLine);routeLine=null;}
  document.getElementById('btnStart').disabled=true;
  document.getElementById('btnStop').disabled=false;
  document.getElementById('receipt').classList.remove('show');
  document.getElementById('statusPill').classList.add('running');
  document.getElementById('statusText').textContent='Running';
  timerInterval=setInterval(()=>{ elapsedSec++; refreshUI(); },1000);
  watchId=navigator.geolocation.watchPosition(onGPS, onGPSErr,
    {enableHighAccuracy:true, maximumAge:2000, timeout:10000});
}

// â”€â”€ GPS callback â”€â”€
function onGPS(pos){
  const {latitude:lat,longitude:lng,accuracy,speed}=pos.coords;
  document.getElementById('latDisplay').textContent=lat.toFixed(5);
  document.getElementById('lngDisplay').textContent=lng.toFixed(5);
  document.getElementById('accDisplay').innerHTML=Math.round(accuracy)+'<span class="s-unit">m</span>';
  document.getElementById('speedDisplay').innerHTML=(speed?Math.round(speed*3.6):0)+'<span class="s-unit">km/h</span>';
  if(running&&lastPos){
    const d=haversine(lastPos.lat,lastPos.lng,lat,lng);
    if(d>0.005) totalKm+=d;
  }
  lastPos={lat,lng};
  const ll=[lat,lng]; routePts.push(ll);
  if(!marker) marker=L.marker(ll,{icon:taxiIcon}).addTo(map);
  else marker.setLatLng(ll);
  if(!accCircle)
    accCircle=L.circle(ll,{radius:accuracy,color:'#f5c518',fillColor:'#f5c518',fillOpacity:.06,weight:1}).addTo(map);
  else accCircle.setLatLng(ll).setRadius(accuracy);
  if(routePts.length>1){
    if(routeLine) map.removeLayer(routeLine);
    routeLine=L.polyline(routePts,{color:'#f5c518',weight:4,opacity:.85}).addTo(map);
  }
  map.setView(ll,Math.max(map.getZoom(),16));
}

function onGPSErr(e){ document.getElementById('accDisplay').innerHTML='âš ï¸'; }

// â”€â”€ Stop â”€â”€
function stopRide(){
  running=false;
  clearInterval(timerInterval);
  if(watchId!==null){navigator.geolocation.clearWatch(watchId);watchId=null;}
  document.getElementById('btnStart').disabled=false;
  document.getElementById('btnStop').disabled=true;
  document.getElementById('statusPill').classList.remove('running');
  document.getElementById('statusText').textContent='Stopped';
  const b=+document.getElementById('baseFare').value||0;
  const k=+document.getElementById('perKm').value||0;
  const m=+document.getElementById('perMin').value||0;
  const dc=totalKm*k, tc=(elapsedSec/60)*m;
  document.getElementById('recBase').textContent    ='$'+fmt(b);
  document.getElementById('recDist').textContent    ='$'+fmt(dc);
  document.getElementById('recTime').textContent    ='$'+fmt(tc);
  document.getElementById('recDuration').textContent=fmtT(elapsedSec);
  document.getElementById('recKm').textContent      =fmt(totalKm)+' km';
  document.getElementById('recTotal').textContent   ='$'+fmt(b+dc+tc);
  document.getElementById('receipt').classList.add('show');
}

// â”€â”€ Reset â”€â”€
function resetRide(){
  stopRide();
  totalKm=0; elapsedSec=0; lastPos=null; routePts=[];
  if(marker){map.removeLayer(marker);marker=null;}
  if(routeLine){map.removeLayer(routeLine);routeLine=null;}
  if(accCircle){map.removeLayer(accCircle);accCircle=null;}
  ['fareValue','timeDisplay'].forEach(id=>document.getElementById(id).textContent='0.00');
  document.getElementById('timeDisplay').textContent='00:00';
  document.getElementById('distDisplay').innerHTML='0.00<span class="s-unit">km</span>';
  document.getElementById('speedDisplay').innerHTML='0<span class="s-unit">km/h</span>';
  document.getElementById('accDisplay').innerHTML='--<span class="s-unit">m</span>';
  document.getElementById('latDisplay').textContent='--';
  document.getElementById('lngDisplay').textContent='--';
  document.getElementById('badgeFare').textContent='$0.00';
  document.getElementById('statusText').textContent='Idle';
  document.getElementById('receipt').classList.remove('show');
  document.getElementById('btnStart').disabled=false;
  document.getElementById('btnStop').disabled=true;
}

// Initial GPS centering
if(navigator.geolocation){
  navigator.geolocation.getCurrentPosition(p=>{
    map.setView([p.coords.latitude,p.coords.longitude],15);
    L.circleMarker([p.coords.latitude,p.coords.longitude],
      {radius:8,color:'#f5c518',fillColor:'#f5c518',fillOpacity:.25,weight:2})
      .addTo(map).bindPopup('ğŸ“ Your location').openPopup();
  },()=>{},{timeout:6000});
}
</script>
</body>
</html>
